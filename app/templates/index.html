{% extends "base.html" %}
{% block title %}Not Steam - Strona Główna{% endblock %}

{% block content %}
 <link rel="stylesheet" href="/static/styles/index.css?v={{ time }}" />
<section aria-label="Recommended games">
  <h2 class="section-title">Recommended games</h2>
  <div class="carousel-wrapper">
    <div class="swiper carousel1" role="region" aria-roledescription="carousel" aria-label="Recommended games carousel">
      <div class="swiper-wrapper">
        {% for game in carousel_games %}
          <div class="swiper-slide">
            <a href="/game/{{ game.id }}">
              <img src="/static/images/{{ game.filename or 'placeholder.jpg' }}" alt="{{ game.title }}" loading="lazy" />
              <p>{{ game.title }}</p>
            </a>
          </div>
        {% endfor %}
      </div>
      <button class="swiper-button-prev swiper-button-prev-1" aria-label="Previous slide"></button>
      <button class="swiper-button-next swiper-button-next-1" aria-label="Next slide"></button>
      <div class="swiper-pagination swiper-pagination-1" role="tablist"></div>
    </div>
  </div>
</section>

<section aria-label="New games">
  <h2 class="section-title">New games</h2>
  <div class="carousel-wrapper">
    <div class="swiper carousel2" role="region" aria-roledescription="carousel" aria-label="New games carousel">
      <div class="swiper-wrapper">
        {% for game in new_games %}
          <div class="tile swiper-slide">
            <a href="/game/{{ game.id }}">
              <img src="/static/images/{{ game.image_filename or 'placeholder.jpg' }}" alt="{{ game.title }}" loading="lazy" />
              <p>{{ game.title }}</p>
            </a>
          </div>
        {% endfor %}
      </div>
      <button class="swiper-button-prev swiper-button-prev-2" aria-label="Previous slide"></button>
      <button class="swiper-button-next swiper-button-next-2" aria-label="Next slide"></button>
      <div class="swiper-pagination swiper-pagination-2" role="tablist"></div>
    </div>
  </div>
</section>

<section aria-label="Genres">
  <h2 class="section-title">Genres</h2>
  <div class="tiles-section">
    <div class="tiles-grid">
      {% for genre in genres_with_game %}
        <div class="tile">
          <a href="/genre/{{ genre.genre_id }}">
            <img src="/static/images/{{ genre.image_filename or 'placeholder.jpg' }}" alt="{{ genre.genre_name }}" loading="lazy" />
            <p>{{ genre.genre_name }}<br><small>({{ genre.game_title }})</small></p>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<section aria-label="Rating">
  <div class="rating-bar" role="radiogroup" aria-label="Oceń stronę">
    <p>Oceń stronę:</p>
    <div class="stars">
      {% for i in range(1,6) %}
        <span tabindex="0" class="star" data-value="{{ i }}" role="radio" aria-checked="false" aria-label="{{ i }} star">&#9734;</span>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const swiper1 = new Swiper('.carousel1', {
    slidesPerView: 3,
    loop: true,
    spaceBetween: 20,
    navigation: {
      nextEl: '.swiper-button-next-1',
      prevEl: '.swiper-button-prev-1',
    },
    pagination: {
      el: '.swiper-pagination-1',
      clickable: true,
    },
  });

  const swiper2 = new Swiper('.carousel2', {
    slidesPerView: 6,
    loop: true,
    spaceBetween: 15,
    navigation: {
      nextEl: '.swiper-button-next-2',
      prevEl: '.swiper-button-prev-2',
    },
    pagination: {
      el: '.swiper-pagination-2',
      clickable: true,
    },
  });

  const stars = document.querySelectorAll('.star');
  stars.forEach(star => {
    star.addEventListener('click', () => {
      const rating = parseInt(star.getAttribute('data-value'));
      stars.forEach(s => {
        const val = parseInt(s.getAttribute('data-value'));
        s.classList.toggle('filled', val <= rating);
        s.setAttribute('aria-checked', val === rating);
      });
      // Tutaj można dodać wysłanie oceny na serwer
    });

    star.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        star.click();
      }
    });
  });
</script>
{% endblock %}
