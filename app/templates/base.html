<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Not Steam - Strona GÅ‚Ã³wna{% endblock %}</title>
  <link rel="stylesheet" href="/static/style.css?v={{ time }}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>
<body>

  <!-- NagÅ‚Ã³wek z paskiem wyszukiwania -->
  <div class="main">
    <p>GameZone</p>

    <div class="search-bar">
  <input type="text" id="searchInput" placeholder="Szukaj gier lub uÅ¼ytkownikÃ³w...">
  <div id="searchResults" class="search-results hidden"></div>
</div>


    {% if current_user %}
      <div class="user-info">
        <span class="username">ðŸ‘¤ {{ current_user.username }}</span>
        <a href="/logout" class="logout-button">Wyloguj</a>
      </div>
    {% else %}
      <div class="user-info">
        <a href="/login" class="auth-button">Zaloguj</a>
        <a href="/register" class="auth-button">Rejestracja</a>
      </div>
    {% endif %}
  </div>

  <button class="menu-toggle">â˜°</button>

  <!-- Sidebar / menu boczne -->
<nav class="sidebar hidden">
  <ul>
    <li><a href="/">Strona gÅ‚Ã³wna</a></li>
    <li><a href="/friends">Znajomi</a></li>
    <li><a href="/library">Biblioteka</a></li>
    {% if current_user %}
      <li><a href="/profile">Profil</a></li>
      <li><a href="/logout">Wyloguj</a></li>
    {% else %}
      <li><a href="/login">Zaloguj siÄ™</a></li>
      <li><a href="/register">Rejestracja</a></li>
    {% endif %}
  </ul>
</nav>


  {% block content %}{% endblock %}

  <footer class="site-footer">
    <div class="footer-content">
      <p>&copy; 2025 Not Steam. Wszystkie prawa zastrzeÅ¼one.</p>
      <div class="footer-links">
        <a href="#">Regulamin</a>
        <a href="#">Polityka prywatnoÅ›ci</a>
        <a href="#">Kontakt</a>
      </div>
    </div>
  </footer>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
  const menuToggle = document.querySelector('.menu-toggle');
  const sidebar = document.querySelector('.sidebar');

  menuToggle.addEventListener('click', () => {
    sidebar.classList.toggle('hidden');
  });

  const input = document.getElementById('searchInput');
  const resultsBox = document.getElementById('searchResults');

  input.addEventListener('blur', () => {
    // Po odfocusowaniu ukryj podpowiedzi z maÅ‚ym opÃ³Åºnieniem (Å¼eby kliknÄ…Ä‡ link)
    setTimeout(() => {
      resultsBox.style.display = 'none';
    }, 150);
  });

  input.addEventListener('focus', () => {
    if (resultsBox.innerHTML.trim() !== '') {
      resultsBox.style.display = 'block';
    }
  });

  // Event input â€” wywoÅ‚uje fetch i pokazuje podpowiedzi
  input.addEventListener('input', async () => {
    const query = input.value.trim();
    if (query.length < 2) {
      resultsBox.style.display = 'none';
      return;
    }

    try {
      const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
      if (!res.ok) throw new Error('BÅ‚Ä…d sieci');
      const data = await res.json();

      let html = '';

      if (data.games.length > 0) {
        html += `<strong>Gry:</strong><br>`;
        data.games.forEach(game => {
          html += `<a href="/game/${game.id}">${game.title}</a><br>`;
        });
      }

      if (data.users.length > 0) {
        html += `<strong>UÅ¼ytkownicy:</strong><br>`;
        data.users.forEach(user => {
          // link do profilu po username w query param (moÅ¼esz zmieniÄ‡ jak chcesz)
          html += `<a href="/profile?username=${encodeURIComponent(user.username)}">${user.username}</a><br>`;
        });
      }

      if (!html) {
        html = '<em>Brak wynikÃ³w</em>';
      }

      resultsBox.innerHTML = html;
      resultsBox.style.display = 'block';

    } catch (err) {
      resultsBox.innerHTML = '<em>BÅ‚Ä…d podczas wyszukiwania</em>';
      resultsBox.style.display = 'block';
    }
  });

  // Po naciÅ›niÄ™ciu Enter w input przekieruj na /profile?q=...
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      const query = input.value.trim();
      if (query.length > 0) {
        window.location.href = `/profile?q=${encodeURIComponent(query)}`;
      }
    }
  });
</script>


  {% block scripts %}{% endblock %}

</body>
</html>
