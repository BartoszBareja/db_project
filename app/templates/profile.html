{% extends "base.html" %}
{% block title %}Profil{% endblock %}

{% block content %}
<link rel="stylesheet" href="/static/styles/profile.css?v={{ time }}" />

<div class="profile-container">
  <div class="profile-header">
    <img class="profile-avatar" src="{{ user.profile_picture or '/static/default_avatar.png' }}" alt="Avatar użytkownika">
    <div class="profile-username">{{ user.username }}</div>
  </div>

  <div class="profile-info">
    <p><span>Opis:</span>
      {% if user.profile_description %}
        {{ user.profile_description }}
      {% else %}
        <span class="empty">Brak opisu</span>
      {% endif %}
    </p>

    {% if current_user %}
      <p><span>Email:</span> {{ user.email }}</p>
      <p><span>Kraj:</span>
        {% if user.country_id %}
          {{ user.country_id }}
        {% else %}
          <span class="empty">Nie podano</span>
        {% endif %}
      </p>
      <p><span>Data urodzenia:</span>
        {% if user.birth_date %}
          {{ user.birth_date }}
        {% else %}
          <span class="empty">Nie podano</span>
        {% endif %}
      </p>
      <p><span>Status:</span> {{ user.status or 'Brak statusu' }}</p>
      <p><span>Saldo portfela:</span> {{ user.wallet_balance }}</p>
    {% endif %}
  </div>

  {% if current_user %}
    {% if current_user['id'] != user['id'] %}
      {% if not is_friend %}
        <form action="/friends/add/{{ user.username }}" method="post">
          <button type="submit" class="add-friend-btn">➕ Dodaj do znajomych</button>
        </form>
      {% else %}
        <p class="already-friends">✔️ Jesteście już znajomymi</p>
      {% endif %}
    {% else %}
      <a href="/profile_edit" class="edit-profile-btn">Edytuj profil</a>
    {% endif %}
  {% endif %}
</div>

{% if current_user %}
  <div class="friends-section">
    <h2>Znajomi</h2>
    {% if friends and friends|length > 0 %}
      <ul class="friend-list">
        {% for friend in friends %}
          <li><a href="/profile/{{ friend.username }}">{{ friend.username }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Brak znajomych.</p>
    {% endif %}
  </div>

  <div class="wishlist">
    <h2>Wishlist</h2>
    {% if wishlist and wishlist|length > 0 %}
      <ul>
        {% for game in wishlist %}
          <li><a href="/game/{{ game.id }}">{{ game.title }}</a></li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Brak gier na liście życzeń.</p>
    {% endif %}
  </div>
{% endif %}

<h2>Osiągnięcia użytkownika</h2>
{% if achievements %}
  <ul class="achievement-list">
    {% for a in achievements %}
      <li class="achievement-item">
        <strong>{{ a.name }}</strong> ({{ a.points }} pkt)
        {% if a.description %}
          <p>{{ a.description }}</p>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>Użytkownik nie ma jeszcze żadnych osiągnięć.</p>
{% endif %}

{% endblock %}
